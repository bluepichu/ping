$(function(){$(".fixed-action-btn").click(function(){var e=$("#modal-create");e.find("#create-name").val(""),e.find("#create-description").val(""),e.find("#create-public").prop("checked",!0),e.openModal()});var e=new function(){this.count=0,this.defaultImg='<div class="icon"><i class="mdi-action-event"></i></div>',this.$columns=[$("#col1"),$("#col2"),$("#col3")],this.add=function(e,i,n){var s='<img src="'+n+'"/>';void 0===n&&(s=this.defaultImg),this.$columns[this.count%3].append('<div class="card small waves-effect waves-light"><div class="card-image fill-card">'+s+'<span class="card-title">'+e+"</span></div></div>").data("id",i).click(function(){t.show($(this).data("id"))}),this.count++},this.clear=function(){this.count=0,this.$columns.forEach(function(e){e.empty()})}},t=new function(){var e=this;this.$modal=$("#modal-event"),this.$more=$("#modal-more"),this.$organizers=this.$modal.find("#event-organizers .col"),this.ocount=0,this.$participants=this.$modal.find("#event-participants .col"),this.pcount=0,this.$channels=this.$modal.find("#event-channels .col"),this.$channelSelect=this.$modal.find("#channel-select"),this.ccount=0,this.$submit=this.$modal.find("#submit-event"),this.id=void 0,this.favorite=!1,this.participants=[],this.isOrganizer=!1,this.$matches=this.$more.find("#more-matches"),this.$brackets=this.$more.find("#more-brackets"),this.$submit.click(function(){e.toggle()}),this.$modal.find("#event-more").click(function(){e.showMore()}),this.show=function(t){this.id=t;var i=new XMLHttpRequest;i.onload=function(){if(200!=this.status)Materialize.toast(this.responseText,4e3);else{var t=JSON.parse(i.responseText);if(t.ok){e.setTitle(t.name),e.setDescription(t.description),e.$organizers.empty(),e.$participants.empty(),e.$channels.empty(),e.$channelSelect.material_select("destroy"),e.$channelSelect.empty();for(var n=0;n<t.organizers.length;n++)e.addOrganizer(t.organizers[n]);for(var n=0;n<t.participants.length;n++)e.addParticipant(t.participants[n]);for(var n=0;n<t.channels.length;n++)e.addChannel(t.channels[n]);e.$channelSelect.find("option:first-child").prop("selected",!0),e.$channelSelect.material_select(),console.log(e.$modal.find("#event-channels").find(".channel input")),e.$modal.find("#event-channels").find(".channel input").click(function(){console.log("clicked channel"),console.log($(this).parent().parent().parent().text().trim().toLowerCase()),$("body").append('<img src="/qr/'+e.id+"/"+$(this).parent().parent().parent().text().trim().toLowerCase()+'" class="materialboxed" id="z"/>');var t=$("#z");t.materialbox(),t.click(),t.click(function(){t.remove()})}),e.favorite=!0,e.$submit.text("Remove"),e.isOrganizer=t.organizers.indexOf($.cookie("phone"))>=0,e.isOrganizer?$(".organizer-only").css("display","block"):$(".organizer-only").css("display","none"),e.$modal.openModal()}else Materialize.toast("Request failed: "+t.reason,4e3)}},i.open("GET","/event/:handle&slug="+this.id,!0),i.setRequestHeader("Content-Type","application/json"),i.send()},this.setTitle=function(e){$("#event-title").text(e)},this.setDescription=function(e){e?$("#event-description").text(e):$("#event-description").html("<p style='opacity: .54'>No description.</p>")},this.addOrganizer=function(e,t){t=void 0===t?'<i class="mdi-action-account-circle"></i>':'<img src="'+t+'" />',$(this.$participants[this.ocount]).append('<div class="participant">'+t+"<span>"+e+"</span></div>"),this.ocount=(this.ocount+1)%2},this.addParticipant=function(e,t){t=void 0===t?'<i class="mdi-action-account-circle"></i>':'<img src="'+t+'" />',$(this.$participants[this.pcount]).append('<div class="participant">'+t+"<span>"+e+"</span></div>"),this.pcount=(this.pcount+1)%3},this.addChannel=function(e,t){$(this.$channels[this.ccount]).append("<div><span>"+e+'</span><div class="switch" style="float: right"><label><input type="checkbox"'+(t?'checked="checked"':"")+'><span class="lever"></span></label></div></div>'),this.$channelSelect.append("<option value='"+e+"' name='"+e+"'>"+e+"</option>"),this.ccount=(this.ccount+1)%3},this.toggle=function(){console.log(this.id),this.favorite?this.$submit.text("Add"):this.$submit.text("Remove"),this.favorite=!this.favorite},this.addMatch=function(){this.$matches.add("<div")},this.showMore=function(){this.$modal.closeModal(),setTimeout(function(){e.$more.openModal({complete:function(){setTimeout(function(){e.$modal.openModal()},100)}})},300),$("#more-title").text($("#event-title").text()),$("#more-description").text($("#event-description").text());for(var t=new tbracket("single","strict"),i=0;7>i;i++)t.addParticipant("Team "+(i+1));t.startTournament();var n=function(){e.$matches.is(":empty")||e.$matches.empty()},s=function(){e.$brackets.is(":empty")||e.$brackets.empty(),e.$brackets.bracket({init:t.getData(),skipConsolationRound:!t.isConsolation(),save:t.saveFn,userData:"",onMatchClick:function(e){console.log(e)}})}}},i=function(){var t=new XMLHttpRequest;t.onload=function(){if(200!=this.status)Materialize.toast(this.responseText,4e3);else{var i=JSON.parse(t.responseText);if(i.ok)for(var n=0;n<i.events.length;n++)e.add(i.events[n].name,i.events[n].slug,i.events[n].image);else Materialize.toast("Request failed: "+i.reason,4e3)}},t.open("GET","/event/listall",!0),t.send()};i(),$("#create-form").submit(function(e){e.preventDefault();for(var t=$(this).serializeArray(),i={},n=0;n<t.length;n++)i[t[n].name]=t[n].value;var s=new XMLHttpRequest;s.onload=function(){if(200!=this.status)Materialize.toast(this.responseText,4e3);else{var e=JSON.parse(this.responseText);e.ok?(Materialize.toast("Event created.",2e3),$("#modal-create").closeModal(),setTimeout(function(){location.reload()},2e3)):Materialize.toast("Request failed: "+e.reason,4e3)}},s.open("POST","/event/new",!0),s.setRequestHeader("Content-Type","application/json"),s.send(JSON.stringify(i))}),$("#create-event").click(function(){$("#create-form").trigger("submit")}),$("#create-name").bind("change paste input keyup",function(){$(this).data("previous")||$(this).data("previous",""),$("#create-slug").val()==$(this).data("previous").toLowerCase().replace(/\s+/g,"-").replace(/[^A-Za-z0-9-]/g,"")&&$("#create-slug").val($(this).val().toLowerCase().replace(/\s+/g,"-").replace(/[^A-Za-z0-9-]/g,"")),$(this).data("previous",$(this).val())}),$("#new-channel").click(function(){$("#modal-event").closeModal(),setTimeout(function(){$("#modal-add-channel").openModal()},300)}),$("#post-message-submit").click(function(){$("form#post-message").submit()}),$("form#post-message").submit(function(e){e.preventDefault();var i=new XMLHttpRequest;i.onload=function(){if(200!=this.status)Materialize.toast(this.responseText,4e3);else{var e=JSON.parse(this.responseText);e.ok?Materialize.toast("Message posted."):Materialize.toast("Request failed: "+e.reason,4e3)}},i.open("POST","/post/"+t.id+"/"+$("#channel-select").val(),!0),i.setRequestHeader("Content-Type","application/json"),i.send(JSON.stringify({message:$("#message-text").val()}))})});