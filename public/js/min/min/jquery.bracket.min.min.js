!function(n){function e(n){return!isNaN(parseFloat(n))&&isFinite(n)}function t(n){function e(n,t){return n instanceof Array?e(n[0],t+1):t}return e(n,0)}function r(n,e){return e>0&&(n=r([n],e-1)),n}function i(){return{source:null,name:null,id:-1,idx:-1,score:null}}function a(n){if(e(n.a.score)&&e(n.b.score)){if(n.a.score>n.b.score)return[n.a,n.b];if(n.a.score<n.b.score)return[n.b,n.a]}return[]}function s(n){return a(n)[0]||i()}function o(n){return a(n)[1]||i()}function c(e,t,r){var i,a=r.find(".team[data-teamid="+e+"]");return i=t?t:"highlight",{highlight:function(){a.each(function(){n(this).addClass(i),n(this).hasClass("win")&&n(this).parent().find(".connector").addClass(i)})},deHighlight:function(){a.each(function(){n(this).removeClass(i),n(this).parent().find(".connector").removeClass(i)})}}}function l(e,t,r){var i=r||t,a=i.winner(),s=i.loser(),o=null,l=null;a&&s&&(o=c(a.idx,"highlightWinner",e),l=c(s.idx,"highlightLoser",e),o.highlight(),l.highlight()),e.find(".team").mouseover(function(){var t=n(this).attr("data-teamid"),r=c(t,null,e);r.highlight(),n(this).mouseout(function(){r.deHighlight(),n(this).unbind("mouseout")})})}function u(e,t,r){var i=n('<input type="text">');i.val(t),e.html(i),i.focus(),i.blur(function(){r(i.val())}),i.keydown(function(n){var e=n.keyCode||n.which;(9===e||13===e||27===e)&&(n.preventDefault(),r(i.val(),27!==e))})}function h(n,e){n.append(e)}function d(n){var e=n.el,t=e.find(".team.win");t.append('<div class="bubble">1st</div>');var r=e.find(".team.lose");return r.append('<div class="bubble">2nd</div>'),!0}function f(n){var e=n.el,t=e.find(".team.win");t.append('<div class="bubble third">3rd</div>');var r=e.find(".team.lose");return r.append('<div class="bubble fourth">4th</div>'),!0}function v(n,e,t,r){for(var i,a=Math.log(2*e.length)/Math.log(2),s=e.length,o=0;a>o;o+=1){i=n.addRound();for(var c=0;s>c;c+=1){var l=null;if(0===o&&(l=function(){var n=e[c],t=c;return[{source:function(){return{name:n[0],idx:2*t}}},{source:function(){return{name:n[1],idx:2*t+1}}}]}),o===a-1&&t){var u=i.addMatch(l,d);u.setAlignCb(function(n){n.css("top",""),n.css("position","absolute"),r?n.css("top",u.el.height()/2-n.height()/2+"px"):n.css("bottom",-n.height()/2+"px")})}else i.addMatch(l)}s/=2}if(t&&(n["final"]().connectorCb(function(){return null}),e.length>1&&!r)){var h=n["final"]().round().prev().match(0).loser,v=n["final"]().round().prev().match(1).loser,p=i.addMatch(function(){return[{source:h},{source:v}]},f);p.setAlignCb(function(e){var t=n.el.height()/2;p.el.css("height",t+"px");var r=e.height();e.css("top",r+"px")}),p.connectorCb(function(){return null})}}function p(n,e,t){for(var r=Math.log(2*t)/Math.log(2)-1,i=t/2,a=0;r>a;a+=1){for(var s=0;2>s;s+=1)for(var o=e.addRound(),c=0;i>c;c+=1){var l=null;(0!==s%2||0===a)&&(l=function(){if(0===s%2&&0===a)return[{source:n.round(0).match(2*c).loser},{source:n.round(0).match(2*c+1).loser}];var t=c;return 0===a%2&&(t=i-c-1),[{source:e.round(2*a).match(c).winner},{source:n.round(a+1).match(t).loser}]});var u=o.addMatch(l),h=u.el.find(".teamContainer");if(u.setAlignCb(function(){h.css("top",u.el.height()/2-h.height()/2+"px")}),r-1>a||1>s){var d=null;0===s%2&&(d=function(n,e){var t=n.height()/4,r=0,i=0;return 0===e.winner().id?i=t:1===e.winner().id?(r=2*-t,i=t):i=2*t,{height:r,shift:i}}),u.connectorCb(d)}}i/=2}}function g(n,e,t,r,i,a){var s=n.addRound(),o=s.addMatch(function(){return[{source:e.winner},{source:t.winner}]},function(i){var s=!1;if(r||null===i.winner().name||i.winner().name!==t.winner().name)return d(i);if(2!==n.size()){var o=n.addRound(function(){var e=null!==i.winner().name&&i.winner().name===t.winner().name;return s===!1&&e&&(s=!0,a.css("width",parseInt(a.css("width"),10)+140+"px")),!e&&s&&(s=!1,n.dropRound(),a.css("width",parseInt(a.css("width"),10)-140+"px")),e}),c=o.addMatch(function(){return[{source:i.first},{source:i.second}]},d);return i.connectorCb(function(n){return{height:0,shift:n.height()/2}}),c.connectorCb(function(){return null}),c.setAlignCb(function(n){var r=e.el.height()+t.el.height();c.el.css("height",r+"px");var i=(e.el.height()/2+e.el.height()+t.el.height()/2)/2-n.height();n.css("top",i+"px")}),!1}});o.setAlignCb(function(n){var r=e.el.height()+t.el.height();i||(r/=2),o.el.css("height",r+"px");var a=(e.el.height()/2+e.el.height()+t.el.height()/2)/2-n.height();n.css("top",a+"px")});var c,l;if(!i){var u=t["final"]().round().prev().match(0).loser,h=s.addMatch(function(){return[{source:u},{source:t.loser}]},f);h.setAlignCb(function(n){var r=(e.el.height()+t.el.height())/2;h.el.css("height",r+"px");var i=(e.el.height()/2+e.el.height()+t.el.height()/2)/2+n.height()/2-r;n.css("top",i+"px")}),o.connectorCb(function(){return null}),h.connectorCb(function(){return null})}e["final"]().connectorCb(function(n){var r=n.height()/4,i=(e.el.height()/2+e.el.height()+t.el.height()/2)/2-n.height()/2,a=i-e.el.height()/2;return 0===e.winner().id?(l=a+2*r,c=r):1===e.winner().id?(l=a,c=3*r):(l=a+r,c=2*r),l-=n.height()/2,{height:l,shift:c}}),t["final"]().connectorCb(function(n){var r=n.height()/4,i=(e.el.height()/2+e.el.height()+t.el.height()/2)/2-n.height()/2,a=i-e.el.height()/2;return 0===t.winner().id?(l=a,c=3*r):1===t.winner().id?(l=a+2*r,c=r):(l=a+r,c=2*r),l+=n.height()/2,{height:-l,shift:-c}})}function m(e,t,r,i,a,s){var o=[],c=n('<div class="round"></div>');return{el:c,bracket:e,id:r,addMatch:function(n,t){var a,c=o.length;a=null!==n?n():[{source:e.round(r-1).match(2*c).winner},{source:e.round(r-1).match(2*c+1).winner}];var l=s(this,a,c,i?i[c]:null,t);return o.push(l),l},match:function(n){return o[n]},prev:function(){return t},size:function(){return o.length},render:function(){c.empty(),("function"!=typeof a||a())&&(c.appendTo(e.el),n.each(o,function(n,e){e.render()}))},results:function(){var e=[];return n.each(o,function(n,t){e.push(t.results())}),e}}}function b(e,t,r){var i=[];return{el:e,addRound:function(n){var e=i.length,a=null;e>0&&(a=i[e-1]);var s=m(this,a,e,t?t[e]:null,n,r);return i.push(s),s},dropRound:function(){i.pop()},round:function(n){return i[n]},size:function(){return i.length},"final":function(){return i[i.length-1].match(0)},winner:function(){return i[i.length-1].match(0).winner()},loser:function(){return i[i.length-1].match(0).loser()},render:function(){e.empty();for(var n=0;n<i.length;n+=1)i[n].render()},results:function(){var e=[];return n.each(i,function(n,t){e.push(t.results())}),e}}}function w(e,t,r,i){var a=parseInt(n(".round:first").css("margin-right"),10)/2,s=!0;0>e&&(s=!1,e=-e),2>e&&(e=0);var o=n('<div class="connector"></div>').appendTo(r);o.css("height",e),o.css("width",a+"px"),o.css(i,-a-2+"px"),t>=0?o.css("top",t+"px"):o.css("bottom",-t+"px"),s?o.css("border-bottom","none"):o.css("border-top","none");var c=n('<div class="connector"></div>').appendTo(o);return c.css("width",a+"px"),c.css(i,-a+"px"),s?c.css("bottom","0px"):c.css("top","0px"),o}function C(e,t,r){var i=n('<div class="tools"></div>').appendTo(e),a=n('<span class="increment">+</span>').appendTo(i);if(a.click(function(){var n,e=t.teams.length;for(n=0;e>n;n+=1)t.teams.push(["",""]);return k(r)}),t.teams.length>1&&1===t.results.length||t.teams.length>2&&3===t.results.length){var s=n('<span class="decrement">â€“</span>').appendTo(i);s.click(function(){return t.teams.length>1?(t.teams=t.teams.slice(0,t.teams.length/2),k(r)):void 0})}var o;1===t.results.length&&t.teams.length>1?(o=n('<span class="doubleElimination">de</span>').appendTo(i),o.click(function(){return t.teams.length>1&&t.results.length<3?(t.results.push([],[]),k(r)):void 0})):3===t.results.length&&t.teams.length>1&&(o=n('<span class="singleElimination">se</span>').appendTo(i),o.click(function(){return 3===t.results.length?(t.results=t.results.slice(0,1),k(r)):void 0}))}var k=function(i){function a(n){d=0,k.render(),x&&y&&(x.render(),y.render()),l(M,k,y),n&&(m.results[0]=k.results(),x&&y&&(m.results[1]=x.results(),m.results[2]=y.results()),i.save&&i.save(m,i.userData))}function c(t,r,c,l,u){function h(t,r,c){var l,u=d,h=n('<div class="score" data-resultid="result-'+u+'"></div>');l=r.name&&c&&e(r.score)?r.score:"--",h.append(l),d+=1;var f=r.name?r.name:"--",p=n('<div class="team"></div>'),g=n('<div class="label"></div>').appendTo(p);return 0===t&&p.attr("data-resultid","team-"+u),i.decorator.render(g,f,l),e(r.idx)&&p.attr("data-teamid",r.idx),null===r.name?p.addClass("na"):s(v).name===r.name?p.addClass("win"):o(v).name===r.name&&p.addClass("lose"),p.append(h),null!==r.name&&c&&i.save&&i.save&&(g.addClass("editable"),g.click(function(){function e(){function o(o,c){o&&(i.init.teams[~~(r.idx/2)][r.idx%2]=o),a(!0),s.click(e);var l=i.el.find(".team[data-teamid="+(r.idx+1)+"] div.label:first");l.length&&c===!0&&0===t&&n(l).click()}s.unbind(),i.decorator.edit(s,r.name,o)}var s=n(this);e()}),r.name&&(h.addClass("editable"),h.click(function(){function t(){i.unbind();var s;s=e(r.score)?i.text():"0";var o=n('<input type="text">');o.val(s),i.html(o),o.focus().select(),o.keydown(function(t){e(n(this).val())?n(this).removeClass("error"):n(this).addClass("error");var r=t.keyCode||t.which;if(9===r||13===r||27===r){if(t.preventDefault(),n(this).blur(),27===r)return;var i=M.find("div.score[data-resultid=result-"+(u+1)+"]");i&&i.click()}}),o.blur(function(){var n=o.val();n&&e(n)||e(r.score)?n&&e(n)||!e(r.score)||(n=r.score):n="0",i.html(n),e(n)&&s!==parseInt(n,10)&&(r.score=parseInt(n,10),a(!0)),i.click(t)})}var i=n(this);t()}))),p}var v={a:r[0],b:r[1]},p=null,g=null,m=n('<div class="match"></div>'),b=n('<div class="teamContainer"></div>');if(!i.save){var C=l?l[2]:null;i.onMatchHover&&b.hover(function(){i.onMatchHover(C,!0)},function(){i.onMatchHover(C,!1)}),i.onMatchClick&&b.click(function(){i.onMatchClick(C)})}return v.a.id=0,v.b.id=1,v.a.name=v.a.source().name,v.b.name=v.b.source().name,v.a.score=l?l[0]:null,v.b.score=l?l[1]:null,v.a.name&&v.b.name||!e(v.a.score)&&!e(v.b.score)||(console.log("ERROR IN SCORE DATA: "+v.a.source().name+": "+v.a.score+", "+v.b.source().name+": "+v.b.score),v.a.score=v.b.score=null),{el:m,id:c,round:function(){return t},connectorCb:function(n){p=n},connect:function(n){var e,t,r=b.height()/4,i=m.height()/2;if(n&&null!==n){var a=n(b,this);if(null===a)return;e=a.shift,t=a.height}else 0===c%2?0===this.winner().id?(e=r,t=i):1===this.winner().id?(e=3*r,t=i-2*r):(e=2*r,t=i-r):0===this.winner().id?(e=3*-r,t=-i+2*r):1===this.winner().id?(e=-r,t=-i):(e=2*-r,t=-i+r);b.append(w(t,e,b,f))},winner:function(){return s(v)},loser:function(){return o(v)},first:function(){return v.a},second:function(){return v.b},setAlignCb:function(n){g=n},render:function(){m.empty(),b.empty(),v.a.name=v.a.source().name,v.b.name=v.b.source().name,v.a.idx=v.a.source().idx,v.b.idx=v.b.source().idx;var n=!1;!v.a.name&&""!==v.a.name||!v.b.name&&""!==v.b.name||(n=!0),s(v).name?b.removeClass("np"):b.addClass("np"),b.append(h(t.id,v.a,n)),b.append(h(t.id,v.b,n)),m.appendTo(t.el),m.append(b),this.el.css("height",t.bracket.el.height()/t.size()+"px"),b.css("top",this.el.height()/2-b.height()/2+"px"),g&&g(b);var e=!1;"function"==typeof u&&(e=u(this)),e||this.connect(p)},results:function(){return[v.a.score,v.b.score]}}}var d,f="lr"===i.dir?"right":"left";if(!i)throw Error("Options not set");if(!i.el)throw Error("Invalid jQuery object as container");if(!i.init&&!i.save)throw Error("No bracket data or save callback given");if(void 0===i.userData&&(i.userData=null),!(!i.decorator||i.decorator.edit&&i.decorator.render))throw Error("Invalid decorator input");i.decorator||(i.decorator={edit:u,render:h});var m;i.init||(i.init={teams:[["",""]],results:[]}),m=i.init;var k,x,y,M=n('<div class="jQBracket '+i.dir+'"></div>').appendTo(i.el.empty()),R=m.results;R=r(R,4-t(R)),m.results=R;var T=R.length<=1;i.skipSecondaryFinal&&T&&n.error("skipSecondaryFinal setting is viable only in double elimination mode"),i.save&&C(M,m,i);var A,j,E;T?j=n('<div class="bracket"></div>').appendTo(M):(A=n('<div class="finals"></div>').appendTo(M),j=n('<div class="bracket"></div>').appendTo(M),E=n('<div class="loserBracket"></div>').appendTo(M));var I=64*m.teams.length;j.css("height",I),T&&m.teams.length<=2&&!i.skipConsolationRound&&(I+=40,M.css("height",I)),E&&E.css("height",j.height()/2);var D;return D=T?Math.log(2*m.teams.length)/Math.log(2):2*(Math.log(2*m.teams.length)/Math.log(2)-1)+1,i.save?M.css("width",140*D+40):M.css("width",140*D+10),k=b(j,R&&R[0]?R[0]:null,c),T||(x=b(E,R&&R[1]?R[1]:null,c),y=b(A,R&&R[2]?R[2]:null,c)),v(k,m.teams,T,i.skipConsolationRound),T||(p(k,x,m.teams.length),g(y,k,x,i.skipSecondaryFinal,i.skipConsolationRound,M)),a(!1),{data:function(){return i.init}}},x={init:function(e){var t=this;e.el=this,e.save&&(e.onMatchClick||e.onMatchHover)&&n.error("Match callbacks may not be passed in edit mode (in conjunction with save callback)"),e.dir=e.dir||"lr",e.skipConsolationRound=e.skipConsolationRound||!1,e.skipSecondaryFinal=e.skipSecondaryFinal||!1,"lr"!==e.dir&&"rl"!==e.dir&&n.error('Direction must be either: "lr" or "rl"');var r=k(e);return n(this).data("bracket",{target:t,obj:r}),r},data:function(){var e=n(this).data("bracket");return e.obj.data()}};n.fn.bracket=function(e){return x[e]?x[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void n.error("Method "+e+" does not exist on jQuery.bracket"):x.init.apply(this,arguments)}}(jQuery);