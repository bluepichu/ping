$(function(){$("select").material_select(),$("ul.tabs").tabs(),$(".button-collapse").sideNav();var e=$("#search"),t=$("#search-term");if(t.change(function(){}),e.find("a").click(function(){e.hasClass("active")?(e.blur(),setTimeout(function(){e.removeClass("active")},100),setTimeout(function(){t.val("")},500)):(e.addClass("active"),setTimeout(function(){t.focus()},300))}),$.cookie("authToken"))$("#settings").click(function(){$("#modal-settings").openModal()});else{var o=$("#modal-login"),i=o.find("#login-username"),n=$("#modal-register"),a=$("#modal-verify"),s=n.find("#register-username"),r=n.find("#register-password"),l=n.find("#register-confirm"),c=n.find("#register-submit"),u=a.find("#verify-submit"),f=o.find("#login-submit");$clearFields=[o.find("#login-password"),r,l];var d=function(){$clearFields.forEach(function(e){e.val("")})};$("#settings").text("Login").click(function(){o.find("#login-register").click(function(){s.val(i.val()),o.closeModal(),setTimeout(function(){d(),n.openModal()},300)}),d(),o.openModal()}),$("#logout").click(function(){$.removeCookie("authToken"),location.reload()}),f.click(function(){for(var e=o.find("form").serializeArray(),t={},i=0;i<e.length;i++)t[e[i].name]=e[i].value;t.phone="+1"+t.phone;var n=new XMLHttpRequest;n.onload=function(){if(200!=this.status)Materialize.toast(this.responseText,4e3);else{var e=JSON.parse(n.responseText);e.ok?(Materialize.toast("Login successful."),setTimeout(function(){location.reload()},2e3)):Materialize.toast("Request failed: "+e.reason,4e3)}},n.open("POST","/user/auth",!0),n.setRequestHeader("Content-Type","application/json"),n.send(JSON.stringify(t))}),n.find("#register-login").click(function(){i.val(s.val()),n.closeModal(),setTimeout(function(){d(),o.openModal()},300)});var p=function(){r.val()!=l.val()?l[0].setCustomValidity("Passwords Don't Match"):l[0].setCustomValidity("")};r.change(p),l.keyup(p),c.click(function(){for(var e=n.find("form").serializeArray(),t={},o=0;o<e.length;o++)t[e[o].name]=e[o].value;if(t.phone="+1"+t.phone,""==t.password||t.password!=t.confirm)return void Materialize.toast("Please double check your password fields.",4e3);var i=new XMLHttpRequest;i.onload=function(){if(200!=this.status)Materialize.toast(this.responseText,4e3);else{var e=JSON.parse(i.responseText);e.ok?(n.closeModal(),setTimeout(function(){d(),a.openModal()},300)):Materialize.toast("Request failed: "+e.reason,4e3)}},i.open("POST","/user/new",!0),i.setRequestHeader("Content-Type","application/json"),delete t.confirm,a.find("#phone").val(t.phone),i.send(JSON.stringify(t))}),u.click(function(){for(var e=a.find("form").serializeArray(),t={},o=0;o<e.length;o++)t[e[o].name]=e[o].value;var i=new XMLHttpRequest;i.onload=function(){if(200!=this.status)Materialize.toast(this.responseText,4e3);else{var e=JSON.parse(i.responseText);e.ok?(Materialize.toast("You are now registered!",2e3),setTimeout(function(){location.reload()},2e3)):Materialize.toast("Request failed: "+e.reason,4e3)}},i.open("POST","/user/verify",!0),i.setRequestHeader("Content-Type","application/json"),i.send(JSON.stringify(t))})}$("#unsubscribe").click(function(){$("#modal-settings").closeModal(),setTimeout(function(){$("#modal-confirmation").openModal()},300)})});