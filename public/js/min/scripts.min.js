$(function(){$("select").material_select(),$(".button-collapse").sideNav();var e=$("#search"),o=$("#search-term");if(o.change(function(){}),e.find("a").click(function(){e.hasClass("active")?(e.blur(),setTimeout(function(){e.removeClass("active")},100),setTimeout(function(){o.val("")},500)):(e.addClass("active"),setTimeout(function(){o.focus()},300))}),$.cookie("authToken"))$("#settings").click(function(){$("#modal-settings").openModal()});else{var t=$("#modal-login"),i=t.find("#login-username"),n=$("#modal-register"),a=$("#modal-verify"),s=n.find("#register-username"),r=n.find("#register-password"),l=n.find("#register-confirm"),c=n.find("#register-submit"),u=a.find("#verify-submit"),f=[t.find("#login-password"),r,l],d=function(){f.forEach(function(e){e.val("")})};$("#settings").text("Login").click(function(){t.find("#login-register").click(function(){s.val(i.val()),t.closeModal(),setTimeout(function(){d(),n.openModal()},300)}),d(),t.openModal()}),$("#logout").click(function(){$.removeCookie("authToken"),location.reload()}),n.find("#register-login").click(function(){i.val(s.val()),n.closeModal(),setTimeout(function(){d(),t.openModal()},300)});var p=function(){l[0].setCustomValidity(r.val()!=l.val()?"Passwords Don't Match":"")};r.change(p),l.keyup(p),c.click(function(){for(var e=n.find("form").serializeArray(),o={},t=0;t<e.length;t++)o[e[t].name]=e[t].value;if(o.phone="+1"+o.phone,""==o.password||o.password!=o.confirm)return void Materialize.toast("Please double check your password fields.",4e3);var i=new XMLHttpRequest;i.onload=function(){if(200!=this.status)Materialize.toast(this.responseText,4e3);else{var e=JSON.parse(i.responseText);e.ok?(n.closeModal(),setTimeout(function(){d(),a.openModal()},300)):Materialize.toast("Request failed: "+e.reason,4e3)}},i.open("POST","/user/new",!0),i.setRequestHeader("Content-Type","application/json"),delete o.confirm,a.find("#phone").val(o.phone),i.send(JSON.stringify(o))}),u.click(function(){for(var e=a.find("form").serializeArray(),o={},t=0;t<e.length;t++)o[e[t].name]=e[t].value;var i=new XMLHttpRequest;i.onload=function(){if(200!=this.status)Materialize.toast(this.responseText,4e3);else{var e=JSON.parse(i.responseText);e.ok?(Materialize.toast("You are now registered!",2e3),setTimeout(function(){location.reload()},2e3)):Materialize.toast("Request failed: "+e.reason,4e3)}},i.open("POST","/user/verify",!0),i.setRequestHeader("Content-Type","application/json"),i.send(JSON.stringify(o))})}$("#unsubscribe").click(function(){$("#modal-settings").closeModal(),setTimeout(function(){$("#modal-confirmation").openModal()},300)})});